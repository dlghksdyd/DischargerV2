<UserControl x:Class="DischargerV2.MVVM.Views.ViewMonitor_State"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:Util="clr-namespace:Utility.Common"
             xmlns:Mex="clr-namespace:MExpress.Mex;assembly=MExpress" 
             xmlns:view="clr-namespace:DischargerV2.MVVM.Views"
             xmlns:vm="clr-namespace:DischargerV2.MVVM.ViewModels"
             xmlns:enum="clr-namespace:DischargerV2.MVVM.Enums"
             xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
             mc:Ignorable="d" 
             d:DataContext="{d:DesignInstance vm:ViewModelMonitor_State}"
             d:DesignHeight="448" d:DesignWidth="442"
             MinHeight="448" MinWidth="442">

    <UserControl.Resources>
        <ResourceDictionary>
            <Util:EDischargerStateToBoolConverter x:Key="EDischargerStateToBoolConverter"/>
            <Util:EDischargerStateToBorderBrushConverter x:Key="EDischargerStateToBorderBrushConverter"/>
            <Util:EDischargerStateToImageConverter x:Key="EDischargerStateToImageConverter"/>
            <Util:EDischargerStateToForegroundConverter x:Key="EDischargerStateToForegroundConverter"/>
            <Util:EDischargerStateToStringConverter x:Key="EDischargerStateToStringConverter"/>
            <Util:EDischargerStateToVisibilityConverter x:Key="EDischargerStateToVisibilityConverter"/>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="20"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="20"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Border BorderThickness="1"
                CornerRadius="8"
                Background="{StaticResource Mex/ResColor/surface_primary}">
            <Border.BorderBrush>
                <MultiBinding Converter="{StaticResource EDischargerStateToBorderBrushConverter}"
                              ConverterParameter="ERROR">
                    <MultiBinding.Bindings>
                        <Binding Path="Model.DischargerStates" Source="{x:Static vm:ViewModelDischarger.Instance}"/>
                        <Binding Path="Model.DischargerIndex" Source="{x:Static vm:ViewModelSetMode.Instance}"/>
                    </MultiBinding.Bindings>
                </MultiBinding>
            </Border.BorderBrush>
            <Grid Margin="20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="12"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Image x:Name="xStateImage" 
                       Grid.Column="0" Grid.Row="0"
                       Width="32" Height="32">
                    <Image.Source>
                        <MultiBinding Converter="{StaticResource EDischargerStateToImageConverter}">
                            <MultiBinding.Bindings>
                                <Binding Path="Model.DischargerStates" Source="{x:Static vm:ViewModelDischarger.Instance}"/>
                                <Binding Path="Model.DischargerIndex" Source="{x:Static vm:ViewModelSetMode.Instance}"/>
                            </MultiBinding.Bindings>
                        </MultiBinding>
                    </Image.Source>
                </Image>
                <Mex:MexTextBlock x:Name="xStateTextBlock"
                                  Grid.Column="2" Grid.Row="0"
                                  FontSet="{StaticResource Mex/ResFontSet/heading_h5}"
                                  TextChanged="xStateTextBlock_TextChanged">
                    <Mex:MexTextBlock.Foreground>
                        <MultiBinding Converter="{StaticResource EDischargerStateToForegroundConverter}"
                                      ConverterParameter="ERROR">
                            <MultiBinding.Bindings>
                                <Binding Path="Model.DischargerStates" Source="{x:Static vm:ViewModelDischarger.Instance}"/>
                                <Binding Path="Model.DischargerIndex" Source="{x:Static vm:ViewModelSetMode.Instance}"/>
                            </MultiBinding.Bindings>
                        </MultiBinding>
                    </Mex:MexTextBlock.Foreground>
                    <Mex:MexTextBlock.Text>
                        <MultiBinding Converter="{StaticResource EDischargerStateToStringConverter}">
                            <MultiBinding.Bindings>
                                <Binding Path="Model.DischargerStates" Source="{x:Static vm:ViewModelDischarger.Instance}"/>
                                <Binding Path="Model.DischargerIndex" Source="{x:Static vm:ViewModelSetMode.Instance}"/>
                            </MultiBinding.Bindings>
                        </MultiBinding>
                    </Mex:MexTextBlock.Text>
                </Mex:MexTextBlock>
                <Mex:MexTextBlock x:Name="xErrorCodeTextBlock"
                                  Grid.Column="2" Grid.Row="2"
                                  Text="Error Code: 0x100201"
                                  Foreground="{StaticResource Mex/ResColor/text_body}"
                                  FontSet="{StaticResource Mex/ResFontSet/body_md_regular}"
                                  HorizontalAlignment="Left" VerticalAlignment="Top">
                    <Mex:MexTextBlock.Visibility>
                        <MultiBinding Converter="{StaticResource EDischargerStateToVisibilityConverter}"
                                      ConverterParameter="ERROR">
                            <MultiBinding.Bindings>
                                <Binding Path="Model.DischargerStates" Source="{x:Static vm:ViewModelDischarger.Instance}"/>
                                <Binding Path="Model.DischargerIndex" Source="{x:Static vm:ViewModelSetMode.Instance}"/>
                            </MultiBinding.Bindings>
                        </MultiBinding>
                    </Mex:MexTextBlock.Visibility>
                </Mex:MexTextBlock>
                <Mex:MexButton x:Name="xDetailButton"
                               Grid.Column="2" Grid.Row="2"
                               Padding="24,12,24,12"
                               Text="Detail"
                               ColorSet="{StaticResource Mex/ResColorSet_Button/Error}"
                               HorizontalAlignment="Right" VerticalAlignment="Bottom">
                    <Mex:MexButton.Visibility>
                        <MultiBinding Converter="{StaticResource EDischargerStateToVisibilityConverter}"
                                      ConverterParameter="ERROR">
                            <MultiBinding.Bindings>
                                <Binding Path="Model.DischargerStates" Source="{x:Static vm:ViewModelDischarger.Instance}"/>
                                <Binding Path="Model.DischargerIndex" Source="{x:Static vm:ViewModelSetMode.Instance}"/>
                            </MultiBinding.Bindings>
                        </MultiBinding>
                    </Mex:MexButton.Visibility>
                </Mex:MexButton>
            </Grid>
        </Border>
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="12"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <!--Pause Button-->
            <Mex:MexButton x:Name="xPauseButton" Grid.Column="0"
                           Padding="24,16,24,16"
                           Text="Pause"
                           TextPadding="12,0,0,0"
                           FontSet="{StaticResource Mex/ResFontSet/heading_h6}"
                           ColorSet="{StaticResource Mex/ResColorSet_Button/PrimaryOutline}"
                           ImageWidth="28" ImageHeight="28"
                           ImageSetLeft="{StaticResource Mex/ResImageSet_Component/PauseButtonOutline}"
                           HorizontalAlignment="Stretch"
                           IsEnabled="{Binding Model.PauseNResumeIsEnable,
                                               Source={x:Static vm:ViewModelMonitor_State.Instance}}">
                <b:Interaction.Triggers>
                    <b:EventTrigger EventName="Click">
                        <b:InvokeCommandAction Command="{Binding PauseDischargeCommand, 
                                                                 Source={x:Static vm:ViewModelMonitor_State.Instance}}"
                                               PassEventArgsToCommand="False"/>
                    </b:EventTrigger>
                </b:Interaction.Triggers>
            </Mex:MexButton>
            <!--Resume Button-->
            <Mex:MexButton x:Name="xResumeButton" Grid.Column="0"
                           Padding="24,16,24,16"
                           Text="Resume"
                           TextPadding="12,0,0,0"
                           FontSet="{StaticResource Mex/ResFontSet/heading_h6}"
                           ColorSet="{StaticResource Mex/ResColorSet_Button/PrimaryOutline}"
                           ImageWidth="28" ImageHeight="28"
                           ImageSetLeft="{StaticResource Mex/ResImageSet_Component/ResumeButtonOutline}"
                           HorizontalAlignment="Stretch">
                <Mex:MexButton.Visibility>
                    <MultiBinding Converter="{StaticResource EDischargerStateToVisibilityConverter}"
                                  ConverterParameter="PAUSE">
                        <MultiBinding.Bindings>
                            <Binding Path="Model.DischargerStates" Source="{x:Static vm:ViewModelDischarger.Instance}"/>
                            <Binding Path="Model.DischargerIndex" Source="{x:Static vm:ViewModelSetMode.Instance}"/>
                        </MultiBinding.Bindings>
                    </MultiBinding>
                </Mex:MexButton.Visibility>
                <b:Interaction.Triggers>
                    <b:EventTrigger EventName="Click">
                        <b:InvokeCommandAction Command="{Binding ResumeDischargeCommand, 
                                                                 Source={x:Static vm:ViewModelMonitor_State.Instance}}"
                                               PassEventArgsToCommand="False"/>
                    </b:EventTrigger>
                </b:Interaction.Triggers>   
            </Mex:MexButton>
            <!--Stop Button-->
            <Mex:MexButton x:Name="xStopButton" Grid.Column="2"
                           Padding="24,16,24,16"
                           Text="Stop"
                           TextPadding="12,0,0,0"
                           FontSet="{StaticResource Mex/ResFontSet/heading_h6}"
                           ColorSet="{StaticResource Mex/ResColorSet_Button/Primary}"
                           ImageWidth="28" ImageHeight="28"
                           ImageSetLeft="{StaticResource Mex/ResImageSet_Component/StopButtonPrimary}"
                           HorizontalAlignment="Stretch"
                           IsEnabled="{Binding Model.StopIsEnable,
                                               Source={x:Static vm:ViewModelMonitor_State.Instance}}">
                <b:Interaction.Triggers>
                    <b:EventTrigger EventName="Click">
                        <b:InvokeCommandAction Command="{Binding StopDischargeCommand, 
                                                                 Source={x:Static vm:ViewModelMonitor_State.Instance}}"
                                               PassEventArgsToCommand="False"/>
                    </b:EventTrigger>
                </b:Interaction.Triggers>
            </Mex:MexButton>
        </Grid>
        <!--Finish Button-->
        <Mex:MexButton x:Name="xFinishButton" Grid.Row="4"
                       Padding="24,16,24,16"
                       Text="Finish"
                       TextPadding="12,0,0,0"
                       FontSet="{StaticResource Mex/ResFontSet/heading_h6}"
                       ColorSet="{StaticResource Mex/ResColorSet_Button/Tertiary}"
                       ImageWidth="28" ImageHeight="28"
                       ImageSetLeft="{StaticResource Mex/ResImageSet_Component/FinishButtonTertiary}"
                       HorizontalAlignment="Stretch"
                       IsEnabled="{Binding Model.FinishIsEnable,
                                           Source={x:Static vm:ViewModelMonitor_State.Instance}}">
            <b:Interaction.Triggers>
                <b:EventTrigger EventName="Click">
                    <b:InvokeCommandAction Command="{Binding ReturnSetModeCommand, 
                                                             Source={x:Static vm:ViewModelMonitor_State.Instance}}"
                                           PassEventArgsToCommand="False"/>
                </b:EventTrigger>
            </b:Interaction.Triggers>
        </Mex:MexButton>
    </Grid>
</UserControl>
