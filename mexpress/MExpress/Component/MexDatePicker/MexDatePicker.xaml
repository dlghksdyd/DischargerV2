<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:local="clr-namespace:MExpress.Mex">

    <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="/MExpress;component/StaticResources/ResColor.xaml"></ResourceDictionary>
        <ResourceDictionary Source="/MExpress;component/StaticResources/ResImage.xaml"></ResourceDictionary>
        <ResourceDictionary Source="/MExpress;component/StaticResources/ResFont.xaml"></ResourceDictionary>
    </ResourceDictionary.MergedDictionaries>

    <local:FontSizeOffsetConverter x:Key="FontSizeOffsetConverter"/>
    <local:ImageColorConverter x:Key="ImageColorConverter"/>
    <local:StringToUpperConverter x:Key="StringToUpperConverter"/>

    <Style TargetType="{x:Type local:MexDatePicker}">
        <Setter Property="Cursor" Value="Hand"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type local:MexDatePicker}">
                    <Grid>
                        <Grid.Clip>
                            <RectangleGeometry RadiusX="{Binding Path=ClipRadius,
                                                                 RelativeSource={RelativeSource AncestorType={x:Type local:MexDatePicker}}}"
                                               RadiusY="{Binding Path=ClipRadius,
                                                                 RelativeSource={RelativeSource AncestorType={x:Type local:MexDatePicker}}}"
                                               Rect="{Binding Path=ClipRect, 
                                                              RelativeSource={RelativeSource AncestorType={x:Type local:MexDatePicker}}}">
                            </RectangleGeometry>
                        </Grid.Clip>
                        <Grid x:Name="xGrid">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid Grid.Column="0" 
                                  Background="{TemplateBinding Background}">
                                <TextBlock x:Name="xWaterMarkTextBlock"
                                           Padding="{TemplateBinding Padding}"
                                           Text="{Binding Path=WaterMark,
                                                          RelativeSource={RelativeSource AncestorType={x:Type local:MexDatePicker}},
                                                          Converter={StaticResource StringToUpperConverter}}"
                                           Foreground="{TemplateBinding WaterMarkForeground}"
                                           FontFamily="{TemplateBinding FontFamily}"
                                           FontSize="{Binding Path=FontSize,
                                                              RelativeSource={RelativeSource AncestorType={x:Type local:MexDatePicker}},
                                                              Converter={StaticResource FontSizeOffsetConverter},
                                                              ConverterParameter=-2.5}"
                                           FontWeight="{TemplateBinding FontWeight}"
                                           HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                           VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                           Visibility="{TemplateBinding WaterMarkVisibility}"
                                           Focusable="False"/>
                                <TextBlock x:Name="xTextBlock" 
                                           Padding="{TemplateBinding Padding}"
                                           Text="{TemplateBinding Text}"
                                           Foreground="{TemplateBinding Foreground}"
                                           FontFamily="{TemplateBinding FontFamily}"
                                           FontSize="{TemplateBinding FontSize}"
                                           FontWeight="{TemplateBinding FontWeight}"
                                           HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                           VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                           Focusable="False"/>
                                <Popup x:Name="xPopup"
                                       Width="{TemplateBinding CalendarSize}"
                                       Height="{TemplateBinding CalendarSize}"
                                       IsOpen="{TemplateBinding IsCalendarOpen}"
                                       StaysOpen="{TemplateBinding CalendarStaysOpen}"
                                       PlacementTarget="{Binding ElementName=xGrid}"
                                       Placement="Bottom"
                                       VerticalOffset="4" HorizontalOffset="0"
                                       AllowsTransparency="True">
                                    <Grid x:Name="xCalendarGrid">
                                        <Grid.Clip>
                                            <RectangleGeometry RadiusX="{Binding Path=ClipRadius,
                                                                                 RelativeSource={RelativeSource AncestorType={x:Type local:MexDatePicker}}}"
                                                               RadiusY="{Binding Path=ClipRadius,
                                                                                 RelativeSource={RelativeSource AncestorType={x:Type local:MexDatePicker}}}"
                                                               Rect="{Binding Path=CalendarClipRect, 
                                                                              RelativeSource={RelativeSource AncestorType={x:Type local:MexDatePicker}}}"/>
                                        </Grid.Clip>
                                        <local:MexCalendar Width="{TemplateBinding CalendarSize}" 
                                                           Height="{TemplateBinding CalendarSize}" 
                                                           SelectedDate="{Binding Path=SelectedDate, 
                                                                                  Mode=TwoWay, 
                                                                                  UpdateSourceTrigger=Explicit,
                                                                                  RelativeSource={RelativeSource AncestorType={x:Type local:MexDatePicker}}}"/>
                                        <Border CornerRadius="{TemplateBinding CornerRadius}"
                                                BorderThickness="{TemplateBinding BorderThickness}"
                                                BorderBrush="{TemplateBinding BorderBrushDefault}"/>
                                    </Grid>
                                </Popup>
                            </Grid>
                            <Grid Grid.Column="1"
                                  Width="{TemplateBinding ButtonWidth}"
                                  Background="{TemplateBinding ButtonColor}">
                                <Image x:Name="xImage"
                                       Width="{TemplateBinding ButtonImageWidth}"
                                       Height="{TemplateBinding ButtonImageHeight}"
                                       Source="{Binding Source={StaticResource Mex/ResImage/calendar_month_outlined}, 
                                                        Converter={StaticResource ImageColorConverter}, 
                                                        ConverterParameter={StaticResource Mex/ResColor/surface_white}}"
                                       VerticalAlignment="Center"
                                       HorizontalAlignment="Center"/>
                            </Grid>
                        </Grid>
                        <Border x:Name="xBorder"
                                Width="{TemplateBinding Width}"
                                Height="{TemplateBinding Height}"
                                CornerRadius="{TemplateBinding CornerRadius}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                VerticalAlignment="{TemplateBinding VerticalAlignment}"
                                HorizontalAlignment="{TemplateBinding HorizontalAlignment}"/>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

</ResourceDictionary>