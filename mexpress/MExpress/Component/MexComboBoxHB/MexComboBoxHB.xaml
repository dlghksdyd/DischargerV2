<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:local="clr-namespace:MExpress.Mex"
                    xmlns:b="http://schemas.microsoft.com/xaml/behaviors">

    <local:DoubleToGridLengthConverter x:Key="DoubleToGridLengthConverter"/>
    
    <Style TargetType="{x:Type local:MexComboBoxHB}">
        <Setter Property="Cursor" Value="Hand"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type local:MexComboBoxHB}">
                    <Border x:Name="xBorder"
                            Width="{TemplateBinding Width}"
                            Height="{TemplateBinding Height}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="{TemplateBinding CornerRadius}"
                            Background="{TemplateBinding Background}">
                        <Grid x:Name="xGrid">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}, Path=Padding.Top, Converter={StaticResource DoubleToGridLengthConverter}}"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}, Path=Padding.Right, Converter={StaticResource DoubleToGridLengthConverter}}"/>
                            </Grid.ColumnDefinitions>
                            <Grid Grid.Column="0">
                                <TextBlock x:Name="xWaterMarkTextBlock"
                                           Text="{TemplateBinding WaterMark}"
                                           Foreground="{TemplateBinding WaterMarkForground}"
                                           Visibility="{TemplateBinding WaterMarkVisibility}"
                                           FontFamily="{TemplateBinding FontFamily}"
                                           FontSize="{TemplateBinding FontSize}"
                                           FontWeight="{TemplateBinding FontWeight}"
                                           HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                           VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                           Padding="{TemplateBinding Padding}"
                                           Focusable="False"/>
                                <TextBlock x:Name="xTextBlock"
                                           Text="{TemplateBinding Text}"
                                           Foreground="{TemplateBinding Foreground}"
                                           FontFamily="{TemplateBinding FontFamily}"
                                           FontSize="{TemplateBinding FontSize}"
                                           FontWeight="{TemplateBinding FontWeight}"
                                           HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                           VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                           Padding="{TemplateBinding Padding}"/>
                                <Popup x:Name="xItemBoxPopup"
                                       Width="{Binding ElementName=xBorder,Path=ActualWidth}"
                                       Height="{TemplateBinding ItemBoxHeight}"
                                       IsOpen="{Binding IsOpenItemBox}"
                                       StaysOpen="{TemplateBinding StaysOpen}"
                                       PlacementTarget="{Binding ElementName=xGrid}"
                                       Placement="Bottom"
                                       HorizontalOffset="-2" VerticalOffset="4"
                                       AllowsTransparency="True">
                                    <local:MexItemBox x:Name="xItemBox" 
                                                      Width="{Binding ElementName=xBorder, Path=ActualWidth}"
                                                      BorderThickness="{Binding BorderThickness}"
                                                      CornerRadius="{Binding CornerRadius}"
                                                      ItemSourceHeight="{Binding ItemSourceHeight}"
                                                      ItemSourceViewCount="{Binding ItemSourceViewCount}"
                                                      ItemSource="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:MexComboBoxHB}, Path=ItemSourceInternal, Mode=TwoWay}"
                                                      ItemSourcePadding="{Binding ItemSourcePadding}"
                                                      FontSet="{Binding ItemSourceFontSet}"
                                                      SelectedIndex="{Binding SelectedIndex, Mode=TwoWay}"
                                                      SelectedItem="{Binding SelectedItem, Mode=TwoWay}"
                                                      ColorSet="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}, Path=ColorSet.ItemBox}"
                                                      HorizontalContentAlignment="{Binding HorizontalContentAlignment}"
                                                      VerticalContentAlignment="{Binding VerticalContentAlignment}">
                                        <b:Interaction.Triggers>
                                            <b:EventTrigger EventName="Loaded">
                                                <b:InvokeCommandAction Command="{Binding ComponentLoadedCommand}"></b:InvokeCommandAction>
                                            </b:EventTrigger>
                                        </b:Interaction.Triggers>
                                    </local:MexItemBox>
                                </Popup>
                            </Grid>
                            <Grid Grid.Column="2">
                                <Image x:Name="xImage"
                                       Width="{TemplateBinding ImageSizeDropDown}"
                                       Height="{TemplateBinding ImageSizeDropDown}"
                                       Source="{TemplateBinding ImageDropDown}">
                                </Image>
                            </Grid>
                        </Grid>
                        <b:Interaction.Triggers>
                            <b:EventTrigger EventName="MouseLeftButtonDown">
                                <b:InvokeCommandAction Command="{Binding OnIsOpenItemBoxChangedCommand}"></b:InvokeCommandAction>
                            </b:EventTrigger>
                            <b:EventTrigger EventName="MouseLeave">
                                <b:InvokeCommandAction Command="{Binding ItemBoxMouseLeaveCommand}"></b:InvokeCommandAction>
                            </b:EventTrigger>
                            <b:EventTrigger EventName="MouseEnter">
                                <b:InvokeCommandAction Command="{Binding ItemBoxMouseEnterCommand}"></b:InvokeCommandAction>
                            </b:EventTrigger>
                        </b:Interaction.Triggers>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

</ResourceDictionary>