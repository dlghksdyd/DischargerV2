<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:local="clr-namespace:MExpress.Mex"
                    xmlns:b="http://schemas.microsoft.com/xaml/behaviors">

    <local:DoubleToGridLengthConverter x:Key="DoubleToGridLengthConverter"/>
    
    <Style TargetType="{x:Type local:MexComboBox}">
        <Setter Property="Cursor" Value="Hand"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type local:MexComboBox}">
                    <Border x:Name="xBorder"
                            Background="{TemplateBinding Background}"
                            Width="{TemplateBinding Width}"
                            Height="{TemplateBinding Height}"
                            CornerRadius="{TemplateBinding CornerRadius}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            BorderBrush="{TemplateBinding BorderBrush}">
                        <Grid x:Name="xGrid">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"></ColumnDefinition>
                                <ColumnDefinition Width="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}, Path=DropDownImageSize, Converter={StaticResource DoubleToGridLengthConverter}}"></ColumnDefinition>
                                <ColumnDefinition Width="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}, Path=Padding.Right, Converter={StaticResource DoubleToGridLengthConverter}}"/>
                            </Grid.ColumnDefinitions>
                            <Grid Grid.Column="0">
                                <TextBlock x:Name="xWaterMarkTextBlock"
                                           Visibility="{TemplateBinding WaterMarkVisibility}"
                                           Text="{TemplateBinding WaterMark}"
                                           Foreground="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:MexComboBox},Path=WaterMarkForground}"
                                           FontFamily="{TemplateBinding FontFamily}"
                                           FontSize="{TemplateBinding FontSize}"
                                           FontWeight="{TemplateBinding FontWeight}"
                                           HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                           VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                           Padding="{TemplateBinding Padding}"
                                           Focusable="False"/>
                                <TextBlock x:Name="xTextBlock" 
                                           Text="{TemplateBinding Text}"
                                           Foreground="{TemplateBinding Foreground}"
                                           FontFamily="{TemplateBinding FontFamily}"
                                           FontSize="{TemplateBinding FontSize}"
                                           FontWeight="{TemplateBinding FontWeight}"
                                           HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                           VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                           Padding="{TemplateBinding Padding}"
                                           Focusable="False"/>
                                <Popup x:Name="xPopup"
                                       Width="{Binding ElementName=xBorder,Path=ActualWidth}"
                                       Height="{Binding ElementName=xGridItem, Path=ActualHeight}"
                                       MaxHeight="{TemplateBinding DropDownMaxHeight}"
                                       IsOpen="{TemplateBinding IsDropDownOpen}"
                                       StaysOpen="{TemplateBinding StaysOpen}"
                                       PlacementTarget="{Binding ElementName=xGrid}"
                                       Placement="Bottom"
                                       VerticalOffset="4"
                                       AllowsTransparency="True">
                                    <Grid Background="{TemplateBinding Background}" Height="Auto" x:Name="xGridItem">
                                        <Grid.Clip>
                                            <RectangleGeometry RadiusX="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:MexComboBox},Path=ClipRadius}"
                                                               RadiusY="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:MexComboBox},Path=ClipRadius}"
                                                               Rect="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:MexComboBox},Path=ClipRect}">
                                            </RectangleGeometry>
                                        </Grid.Clip>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"></RowDefinition>
                                        </Grid.RowDefinitions>
                                        <local:MexScrollViewer x:Name="xDropDownScrollViewer"
                                                               Height="Auto"
                                                               MaxHeight="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:MexComboBox}, Path=DropDownMaxHeight}"
                                                               Background="Transparent"
                                                               VerticalScrollBarVisibility="Auto"
                                                               HorizontalScrollBarVisibility="Hidden">
                                        </local:MexScrollViewer>
                                        <Border CornerRadius="{Binding ElementName=xBorder, Path=CornerRadius}"
                                                BorderThickness="{TemplateBinding BorderThickness}"
                                                BorderBrush="{TemplateBinding BorderBrushDefault}">
                                        </Border>
                                    </Grid>
                                </Popup>
                            </Grid>
                            <Grid Grid.Column="1">
                                <Image x:Name="xImage"
                                       Width="{TemplateBinding DropDownImageSize}"
                                       Height="{TemplateBinding DropDownImageSize}"
                                       Source="{TemplateBinding DropDownImage}">
                                </Image>
                            </Grid>
                        </Grid>
                        <b:Interaction.Triggers>
                            <b:EventTrigger EventName="MouseLeftButtonDown">
                                <b:InvokeCommandAction Command="{Binding OpenDropDownCommand, RelativeSource={RelativeSource AncestorType=local:MexComboBox}}"></b:InvokeCommandAction>
                            </b:EventTrigger>
                            <b:EventTrigger EventName="MouseLeave">
                                <b:InvokeCommandAction Command="{Binding ComboBoxMouseLeaveCommand, RelativeSource={RelativeSource AncestorType=local:MexComboBox}}"></b:InvokeCommandAction>
                            </b:EventTrigger>
                            <b:EventTrigger EventName="MouseEnter">
                                <b:InvokeCommandAction Command="{Binding ComboBoxMouseEnterCommand, RelativeSource={RelativeSource AncestorType=local:MexComboBox}}"></b:InvokeCommandAction>
                            </b:EventTrigger>
                        </b:Interaction.Triggers>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

</ResourceDictionary>